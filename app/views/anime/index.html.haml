.anime-discover.anime-explore
  .row
    .large-12.columns
      .large-9.columns.no-padding
        .large-12.columns.no-padding
          %p.cf.browse-label Browse By:
          %ul.panel.rounded-panel.inline-list.explore-filter
            %li
              %a{"data-dropdown" => "drop1", "data-options" => "is_hover:true", :href => "#"} Year <i class="icon-caret-down"></i>

              %ul#drop1.f-dropdown{"data-dropdown-content" => ""}
                %li
                  %a{:href => "#"} All
                %li
                  %a{:href => "#"} Upcoming
                %li
                  %a{:href => "#"} 2010s
                %li
                  %a{:href => "#"} 2000s
                %li
                  %a{:href => "#"} 1990s
                %li
                  %a{:href => "#"} 1980s
                %li
                  %a{:href => "#"} 1970s

            %li
              %a.genre-filter(href="javascript:void(0)")
                Genre
                %i.icon-caret-down
            
            %li
              %a.popular-filter(href="javascript:void(0)")
                Popular
                %i.icon-caret-down
                  
            %li= link_to "Anticipated", "#"
            %li= link_to "Airing Soon", "#"
      .large-3.columns
        %a.button.padded.secondary(href="/random/anime")
          %i.icon-random
          Something Random


    .large-12.columns
      %h4.top-title= title 'Trending Today'
      %hr.title-divider

      .large-12.columns.no-padding.trending-panel
        %ul
          - @trending_anime.each do |anime|
            = link_to anime do
              %li.large-2.columns.single-wrapper
                .popular-card.tip-top(data-tooltip title="#{anime.canonical_title(current_user)}")
                  %p.wanna-watch
                  = image_tag(anime.cover_image.url(:thumb), alt: anime.canonical_title)
                  %p.title= anime.canonical_title(current_user)
  .row
    .large-12.columns
      .panel.rounded-panel
        .large-12.columns
          %h4 Recently Reviewed
          %hr 
        .large-12.columns.recent-panel
          %ul.recently-reviewed
            - @recent_reviews.each do |review|
              %li.large-1.columns.recent-review.tip-top(data-tooltip title="#{review.anime.canonical_title(current_user)}")
                = link_to image_tag(review.anime.cover_image.url(:thumb), alt: "#{review.anime.canonical_title} Review"), anime_review_path(review.anime, review)

  .row
    .large-8.columns
      .panel.rounded-panel
        .large-12.columns
          %h4 Trending Reviews
          = render partial: "reviews/review", collection: @trending_reviews, locals: {image: :anime}
          :javascript
            (function() {
              $(".chart").easyPieChart({
                size: 86
              });
            
            }).call(this);
          :css
            .chart {
              margin: 10px;
              font-size: 2em;
              font-weight: bold;
            }
          %hr

          %p.center.reviews-footer
            %a.tip-top(data-tooltip href="javascript:void(0)" title="Coming soon!") Load More Reviews

    .large-4.columns.explore-sidebar
      .panel.rounded-panel.center.side-advert
        .large-12.columns.no-padding-left.no-padding
        :javascript
          google_ad_client = "ca-pub-3410319844519574";
          /* Homepage Sidebar */
          google_ad_slot = "8094424442";
          google_ad_width = 300;
          google_ad_height = 250;

        %script{:src => "http://pagead2.googlesyndication.com/pagead/show_ads.js", :type => "text/javascript"}
      .panel.rounded-panel
        .large-12.columns.no-padding.forum-block
          .large-6.columns.block-title
            %h4 Forum
          .large-6.columns.block-link
            %a.right{:href => "/community/"} view forums
          %hr/
          %ul
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/anime-discussion/topics/most-manly-animes"} Most Manly Animes?
                .forum-time.pull-right
                  %i 9 minutes ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/site-suggestions/topics/a-page-for-the-community"} A page for the community
                .forum-time.pull-right
                  %i 14 minutes ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/bug-reports/topics/mod-request-edit-delete-quotes"} [Mod Request] Edit/delete quotes
                .forum-time.pull-right
                  %i 41 minutes ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/site-suggestions/topics/auto-anime-updade"} auto anime updade
                .forum-time.pull-right
                  %i about 1 hour ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/bug-reports/topics/drop-down-menu-doesn-t-quite-show-remains-on-page"} Drop-down menu doesn't quite...
                .forum-time.pull-right
                  %i about 1 hour ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/site-suggestions/topics/bigger-profile-pic-avatar"} Bigger Profile Pic/Avatar
                .forum-time.pull-right
                  %i about 1 hour ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/site-suggestions/topics/fixed-header-and-side-menu"} Fixed header and side menu
                .forum-time.pull-right
                  %i about 1 hour ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/anime-discussion/topics/what-is-your-dealbreaker-in-anime"} What is your Dealbreaker in Anime?
                .forum-time.pull-right
                  %i about 2 hours ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/anime-discussion/topics/fate-series-anime-watch-order"} Fate series anime watch order
                .forum-time.pull-right
                  %i about 2 hours ago
            %li.large-12.columns.topic-row
              .large-12.columns.no-padding.forum-title
                .pull-left
                  %a{:href => "/community/forums/anime-discussion/topics/anime-gif-thread-go"} Anime GIF thread, go!
                .forum-time.pull-right
                  %i about 2 hours ago

  .popovers.hide
    .genre-filter-popover
      .filter.genre-filter-popover-content
        .row
          - Genre.default_filterable(current_user).each do |genre|
            .large-4.columns
              = link_to genre.name, anime_index_path(filter: true, g: genre), class: 'filter-option'

    .popular-filter-popover
      .filter.popular-filter-popover-content
        = link_to "All Time", anime_index_path(filter: true, pop: "all"), class: 'filter-option'
        = link_to "This Year", anime_index_path(filter: true, pop: "year"), class: 'filter-option'
        = link_to "This Month", anime_index_path(filter: true, pop: "month"), class: 'filter-option'
        = link_to "This Week", anime_index_path(filter: true, pop: "week"), class: 'filter-option'

:coffee
  $("a.genre-filter").popover
    animation: true
    placement: "bottom"
    html: true
    trigger: "manual"
    content: $(".popovers .genre-filter-popover").html()
  
  $("a.popular-filter").popover
    animation: true
    placement: "bottom"
    html: true
    trigger: "manual"
    content: $(".popovers .popular-filter-popover").html()
    
  filterElements = [$("a.genre-filter"), $("a.popular-filter")]
  _.each filterElements, (f) ->
    f.click ->
      _.each filterElements, (f2) -> f2.popover('hide')
      if $(this).hasClass "active-filter"
        $(this).removeClass "active-filter"
      else
        $(this).popover('show')
        $(this).addClass "active-filter"

/   .filter-toolbar
/     .row
/       .large-12.columns
/         %form.autosubmit
/           %ul.inline-list
/             %li.large-3.columns
/               %select.autosubmit{:class => "single-select", :name => "filter"}
/                 %option{:value => "all", :selected => ("selected" if @filter == "all")}
/                   %i.icon-globe
/                   All Anime
/                 %option{:value => "recommended", :selected => ("selected" if @filter == "recommended")}
/                   %i.icon-heart
/                   Recommendations
/                 %option{:value => "unseen", :selected => ("selected" if @filter == "unseen")}
/                   %i.icon-eye-close
/                   Haven't Seen
/                 %option{:value => "unfinished", :selected => ("selected" if @filter == "unfinished")}
/                   %i.icon-tasks
/                   Haven't finished

/             %li.large-3.columns
/               %select{:multiple => "multiple", :class => "multiple-select", :name => "genres[]"}
/                 - @all_genres.each do |genre|
/                   %option{:value => "#{genre.slug}", :selected => ("selected" if @genre_filter.include? genre)}
/                     %i.icon-film
/                     = genre.name

/             %li.large-3.columns
/               %select{:multiple => "multiple", :class => "multiple-nofiltera", :name => "types[]"}
/                 %option{:disabled => "disabled"}
/                   Series
/                 %option{:disabled => "disabled"}
/                   OVA / SPECIAL

/             %li.large-3.columns
/               %select{:multiple => "multiple", :class => "multiple-nofilterb", :name => "watch[]"}
/                 %option{:disabled => "disabled"}
/                   Netflix
/                 %option{:disabled => "disabled"}
/                   Hulu
/                 %option{:disabled => "disabled"}
/                   Crunchyroll
/                 %option{:disabled => "disabled"}
/                   Funimation
/                 %option{:disabled => "disabled"}
/                   Viz

/   .row.content-body
/     .anime-grid.large-12.columns
/       - if @filter == "recommended" and !current_user.recommendations_up_to_date
/         %div.alert-box
/           %span.updating_recommendations We're updating your recommendations. 
/           %span.check_back Check back in a minute!
/         :javascript
/           function checkForCompletion() {
/             $.getJSON("/users.json", function(data) { 
/               if (!data["recommendations_up_to_date"]) {
/                 $("span.check_back").html("Hang on!");
/                 setTimeout("checkForCompletion()", 5000);
/               }
/               else {
/                 $("span.updating_recommendations").html("We're done updating your recommendations.");
/                 $("span.check_back").html("<a href='/anime?filter=recommended'>Check them out!</a>");
/               }
/             });
/           }
/           checkForCompletion();
/       .row
/         - if @collection.length == 0
/           .not-found.panel
/             .title.large-12-columns
/               %h3 We couldn't find what you were looking for!
/               %p To make up for that, here's some random anime... have fun!
/             .row
/           - @collection = Anime.accessible_by(current_ability).order("RANDOM()").limit(6).map {|x| [x, @watchlist[x.id]] }
          
/         = render partial: "anime/card", collection: @collection, as: :data

/       .row.pagination-centered
/         = paginate(@anime)

/       .row
/         .panel(style="text-align: center; padding: 8px; margin-top: 26px; opacity: 0.7")
/           %h5(style="display: inline")
/             Couldn't find what you were looking for?
/           %p(style="display: inline")
/             %a(href="mailto:vikhyat@hummingbird.ly") Send us an email!

/ :javascript
/   function capitalize(s) {
/     return s[0].toUpperCase() + s.substring(1);
/   }
/   $(".multiple-select").multiselect({
/     close: function() {
/       $("form.autosubmit").submit();
/     },
/     noneSelectedText: "All Genres",
/     selectedList: 2,
/     selectedText: function (c, t, a) {
/       if (c == t) {
/         return "All Genres";
/       }
/       else if (c == 2) {
/         return capitalize(a[0].value) + ", " + capitalize(a[1].value);
/       }
/       else if (c == 1) {
/         return capitalize(a[0].value);
/       }
/       else {
/         return c + " genres selected";
/       }
/     }
/   }).multiselectfilter();
/   $(".multiple-nofiltera").multiselect({
/     noneSelectedText: "Any Type",
/     header: "coming soon!",
/     selectedList: 3 // 0-based index
/   });
/   $(".multiple-nofilterb").multiselect({
/     noneSelectedText: "Watch Anywhere",
/     header: "coming soon!",
/     selectedList: 3 // 0-based index
/   });
/   $(".single-select").multiselect({
/     multiple: false,
/     header: "Select an option",
/     noneSelectedText: "Select an Option",
/     selectedList: 1
/   });

/ - if user_signed_in?
/   = render partial: "watchlists/form_modal", collection: @collection.map {|x| x[1] || Watchlist.new(user: current_user, anime: x[0]) }, as: :watchlist
