= render 'shared/header'
.home
  .row.content-body
    / Side Bar
    .three.mobile-twelve.columns
      %ul.accordion
        %li.active
          .title
            %h3 Personalize
          .personalize-filter.content
            %p{:class => (@filter == "all" ? "active" : "")}
              = link_to 'All Anime', filtered_listing_path(:all, :genres => params[:genres])
            %p
              = link_to 'My Recommendations', '#'
            %p{:class => (@filter == "unseen" ? "active" : "")}
              = link_to "Anime I Haven't Seen", filtered_listing_path(:unseen, :genres => params[:genres])
            %p{:class => (@filter == "unfinished" ? "active" : "")}
              = link_to "Anime I Haven't Finished", filtered_listing_path(:unfinished, :genres => params[:genres])

      %ul.accordion
        %li.active    
          .title
            %h3 Filter
          .content
            %form.custom{:action => genres_path, :method => :get}
              .row
                .twelve.columns
                  %input.button.tiny(type="submit" value="Apply")
                  %a.button.tiny.disable_all Deselect All
                  %a.button.tiny.enable_all Select All

                  - @all_genres.each do |genre|
                    %label{:for => genre.slug, "data-width" => "300", :title => genre.description, :class => ("has-tip tip-top" if genre.description && genre.description.length > 0)}
                      %input{:checked => @genre_filter.include?(genre), :name => "g_" + genre.slug, :id => "g_" + genre.slug, :style => "display: none", :type => "checkbox", :value => ".g_#{genre.slug}"}
                        %span.custom.checkbox{:class => ("checked" if @genre_filter.include? genre)}
                      = genre.name

    / Thumbnails
    .anime-grid.nine.columns
      .row
        - @anime.each do |anime|
          = render partial: "card", locals: {anime: anime, watchlist: @watchlist[anime.id]}

      .row.pagination-centered
        = paginate(@anime)

  :javascript
    // Make entire anime grid card overlay a clickable link.
    $(".overlay").click(function (e) {
      if (!e.ctrlKey && !e.metaKey) {
        // Handle click without Ctrl/Cmd.
        window.location = $(this).find("a").attr("href");
      }
      else {
        // Click with Ctrl/Cmd.
        window.open( $(this).find("a").attr("href"), "_blank");
      }
      return false;
    });

    // Filter functionality.
    // TODO make disableAllGenres and enableAllGenres faster.
    function disableAllGenres() {
      $("span.custom.checkbox.checked").click();
    }
    function enableAllGenres() {
      disableAllGenres();
      $("span.custom.checkbox").click();
    }
    $(".disable_all").click(disableAllGenres);
    $(".enable_all").click(enableAllGenres);

= render 'shared/footer'
