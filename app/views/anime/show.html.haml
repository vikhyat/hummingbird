.anime-discover.anime-show
  .row
    / Main Content Section
    / This has been source ordered to come first in the markup (and on small devices) but to be to the right of the nav on larger screens
    .eight.columns
      .panel.anime-details.cards.cf
        .details-left
          = render partial: "card", locals: {data: [@anime, @watchlist]} 
        .details-right.eight.columns
          %h3= title(@anime.canonical_title(current_user))

          .small-summary 
            %span #{pluralize @anime.episode_count, 'episode'} / #{@anime.episode_length} min. each  ||
            %span #{@anime.age_rating}
            - if @anime.alternate_title(current_user) and @anime.alternate_title(current_user).length > 0
              %span (Also known as <strong>#{@anime.alternate_title(current_user)}</strong>)

          .producers
            %p 
            Producers: 
            = @producers.map {|x| link_to(x.name, x) }.join(", ").html_safe

          .genres
            %p 
            Genres:
            = @genres.map {|x| link_to(x.name, x) }.join(", ").html_safe

          .social-links
            %ul.inline-list
              %li
                .fb-like{"data-layout" => "button_count", "data-send" => "false", "data-show-faces" => "false", "data-width" => "50"}
              %li{:style => "background: none; width: 78px;"}
                %a.twitter-share-button{"data-via" => "Hummingbird_ly", :href => "https://twitter.com/share"} Tweet
              %li
                .g-plusone{"data-size" => "medium"}
            
          .synopsis
            %strong Status: #{@anime.status}
            %p #{@anime.synopsis}

      - if can? :update, @anime
        .panel.moderation-tools
          %header 
            .eleven.columns
              Moderation Tools

          .moderation-form
            = form_for @anime do |f|
              .row
                / Episode Count and Length
                .four.columns
                  = f.label :episode_count, class: 'inline'
                .eight.columns
                  = f.number_field :episode_count
                .four.columns
                  = f.label :episode_length, class: 'inline'
                .eight.columns
                  = f.number_field :episode_length
                / TheTVDB Series and Season IDs
                .four.columns
                  = f.label :thetvdb_series_id, "TheTVDB Series ID", class: 'inline'
                .eight.columns
                  = f.number_field :thetvdb_series_id
                .four.columns
                  = f.label :thetvdb_season_id, "TheTVDB Season ID", class: 'inline'
                .eight.columns
                  = f.number_field :thetvdb_season_id
                / MAL ID
                .four.columns
                  = f.label :mal_id, "MAL ID", class: 'inline'
                .eight.columns
                  = f.number_field :mal_id
                / English canonical
                .four.columns
                  = f.label :english_canonical, "English Title Canonical?", class: 'inline'
                .eight.columns
                  = f.check_box :english_canonical

                .twelve.columns
                  = f.submit class: 'button'
            
            = link_to "Get Episodes from TheTVDB", anime_get_episodes_from_thetvdb_path(@anime), class: 'button', method: :post
            = link_to "Get Metadata from MAL", anime_get_metadata_from_mal_path(@anime), class: 'button', method: :post


      .panel.community-rating
        .upper.twelve.columns
          .decoration.three.columns.hide-for-small
            %p.left <i></i>

          - if @anime.wilson_ci
            .six.columns 
              %h6 Community Rating
              %p{:class => @anime.wilson_ci >= 0.5 ? "percentage-positive" : "percentage-negative"}
                %i
                #{(@anime.wilson_ci*100).to_i}%
              %p.based-on Based on #{number_with_delimiter @anime.user_count} Ratings

          .decoration.three.columns.hide-for-small
            %p.right <i></i>
        .lower.twelve.columns
          .positive-review.six.columns
            %h6 Top Rated <span>Positive</span> Review

            - if @top_reviews[:positive]
              %p
                = @top_reviews[:positive].summary || truncate(strip_tags(@top_reviews[:positive].content), length: 300, omission: '...')
                = link_to "read more", anime_review_path(@anime, @top_reviews[:positive])
              %span.user
                = image_tag @top_reviews[:positive].user.avatar.url(:thumb)
                = link_to @top_reviews[:positive].user.name, @top_reviews[:positive].user
            - else
              .no-reviews.nine.columns.centered
                = image_tag "http://cl.ly/image/3u2X0t1B0E11/no-positive-reviews@2x.jpg"
                %p 
                  No positive reviews.
                  %br
                  = link_to new_anime_review_path(@anime) do
                    Write the first!

          .negative-review.six.columns
            %h6 Top Rated <span>Negative</span> Review

            - if @top_reviews[:negative]
              %p
                = @top_reviews[:negative].summary || truncate(strip_tags(@top_reviews[:negative].content), length: 300, omission: '...')
                = link_to "read more", anime_review_path(@anime, @top_reviews[:negative])
              %span.user
                = image_tag @top_reviews[:negative].user.avatar.url(:thumb)
                = link_to @top_reviews[:negative].user.name, @top_reviews[:negative].user
            - else
              .no-reviews.nine.columns.centered
                = image_tag "http://cl.ly/image/0T2u2t2J0Z35/no-negative-reviews@2x.jpg"
                %p 
                  No negative reviews.
                  %br
                  = link_to new_anime_review_path(@anime) do
                    Write the first!
                
        .footer.twelve.columns
          = link_to "view all reviews", anime_reviews_path(@anime)

      .panel.episode-tracker
        %header 
          .eleven.columns
            #{@anime.canonical_title(current_user)} Episodes
          / .one.columns
          /   = link_to "edit", "#"

        = render partial: "episodes/list_four", locals: {episodes: @episodes, anime: @anime}

      .panel.voice-actors
        %header 
          .eleven.columns
            #{@anime.canonical_title(current_user)} Voice Actors
          / .one.columns
          /   = link_to "edit", "#"

        %dl.tabs
          - @languages.each_with_index do |language, i|
            %dd{:class => ("active" if i==0)}
              %a{:href => "##{language}"}= language

        %ul.tabs-content
          - @languages.each_with_index do |language, i|
            %li{:id => "#{language}Tab", :class => ("active" if i==0)}
              %ul
                - @castings.select {|x| x.role == language }.each do |casting|
                  %li.actor-row.twelve.columns
                    .character.five.columns
                      .headshot.two.columns
                        = image_tag casting.character.image.url(:thumb)
                      .name.ten.columns
                        %p= link_to casting.character.name, "#"

                    .divider.two.columns
                      %hr
                    .actor.five.columns
                      .name.ten.columns
                        %p= link_to casting.person.name, "#"
                      .headshot.two.columns
                        = image_tag casting.person.image.url(:thumb)
                  

        %footer.twelve.columns
          %p= link_to "view complete cast", "#"

    / Nav Sidebar
    .four.columns
      - if @anime.youtube_video_id
        .trailer
          .flex-video
            %iframe{:allowfullscreen => "", :frameborder => "0", :height => "315", :src => "http://www.youtube.com/embed/#{@anime.youtube_video_id}", :width => "420"}

      = render "mini_gallery"

      .quotes.twelve.columns
        %h5 #{@anime.canonical_title(current_user)} Quotes

        - @quotes.each do |quote|
          %blockquote
            = quote.content
            â€”
            = quote.character_name
        %p
          = link_to "[Show all]", anime_quotes_url(@anime)
          %a{"data-reveal-id" => "quoteModal", :href => "#"} [Submit quote]

    .similar-anime.twelve.columns.hide-for-small{:style => 'display: none!important'}
      %header
        .four.columns
          %hr
        .four.columns
          %h3 Similar Anime
        .four.columns
          %hr
        .row
          .recommended.six.columns
            .panel.twelve.columns
              .four.columns
                = image_tag "http://localhost:3000/system/anime/cover_images/000/000/137/thumb/20539.jpg?1360397891"
              .eight.columns.end
                %p.title Accel World
                %p Sakamoto Ryota still has no job at age 22, and leads a rather dull life. But in the online game, BTOOOM!, he's stronger and more highly respected than anyone else. However, the game he's playing now is no longer virtual...

                .rating.negative.four.columns
                  54%

          .recommended.six.columns
            .panel.twelve.columns
              .four.columns
                = image_tag "http://localhost:3000/system/anime/cover_images/000/000/137/thumb/20539.jpg?1360397891"
              .eight.columns.end
                %p.title Accel World
                %p Sakamoto Ryota still has no job at age 22, and leads a rather dull life. But in the online game, BTOOOM!, he's stronger and more highly respected than anyone else. However, the game he's playing now is no longer virtual...

                .rating.positive.four.columns
                  72%

// Quote Modal
#quoteModal.reveal-modal{:class => "[expand, xlarge, large, medium, small]"}
  = render "quotes/new"

- if user_signed_in?
  = render partial: "watchlists/form_modal", locals: {watchlist: @watchlist || Watchlist.new(user: current_user, anime: @anime)}
